function Menu(e){function c(e){var n=$("#menu .menu__link.menu__focused").data("id")===e.id?" menu__focused":"",i=$('<li class="menu__ menu__'+e.type+'"></li>'),r=$('<a class="menu__link menu__link_'+e.type+n+'" data-id='+e.id+' href="#">'+e.name+"</a>");r.prepend(function(e){if("folder"===e)return $('<svg class="menu__icon menu__icon_folder" xmlns="http://www.w3.org/2000/svg" viewbox="153 399.8 51 43.2"><path d="M201.6,409.9c-1.3-1.3-2.9-2-4.7-2h-20.2v-1c0-1.8-0.7-3.4-2-4.7c-1.3-1.3-2.9-2-4.7-2h-9.6c-1.8,0-3.4,0.7-4.7,2c-1.3,1.3-2,2.9-2,4.7v28.8c0,1.8,0.7,3.4,2,4.7c1.3,1.3,2.9,2,4.7,2h36.5c1.8,0,3.4-0.7,4.7-2c1.3-1.3,2-2.9,2-4.7v-21.2C203.5,412.8,202.9,411.2,201.6,409.9z M199.7,435.8c0,0.8-0.3,1.5-0.8,2c-0.6,0.6-1.2,0.8-2,0.8h-36.5c-0.8,0-1.5-0.3-2-0.8c-0.6-0.6-0.8-1.2-0.8-2v-28.8c0-0.8,0.3-1.5,0.8-2c0.6-0.6,1.2-0.8,2-0.8h9.6c0.8,0,1.5,0.3,2,0.8c0.6,0.6,0.8,1.2,0.8,2v1.9c0,0.8,0.3,1.5,0.8,2c0.6,0.6,1.2,0.8,2,0.8h21.2c0.8,0,1.5,0.3,2,0.8c0.6,0.6,0.8,1.2,0.8,2L199.7,435.8L199.7,435.8z"></path></svg>');if("file"===e)return $('<svg class="menu__icon menu__icon_file" xmlns="http://www.w3.org/2000/svg" viewbox="120 395.1 42.5 51"><path d="M161.4,410.5c-0.4-1-1-1.9-1.6-2.5l-10.2-10.2c-0.6-0.6-1.4-1.1-2.5-1.6c-1-0.4-2-0.7-2.9-0.7h-20.8c-0.9,0-1.6,0.3-2.2,0.9c-0.6,0.6-0.9,1.3-0.9,2.2v43.8c0,0.9,0.3,1.6,0.9,2.2c0.6,0.6,1.3,0.9,2.2,0.9H159c0.9,0,1.6-0.3,2.2-0.9c0.6-0.6,0.9-1.3,0.9-2.2v-29.2C162.1,412.5,161.9,411.5,161.4,410.5z M145.4,400.1c0.6,0.2,1.1,0.5,1.3,0.7L157,411c0.3,0.3,0.5,0.7,0.7,1.3h-12.2V400.1z M157.9,441.5h-33.3v-41.7h16.7v13.5c0,0.9,0.3,1.6,0.9,2.2c0.6,0.6,1.3,0.9,2.2,0.9h13.5V441.5z"></path></svg>')}(e.type)),i.append(r);var t=$('<ul class="menu_sub"></ul>');return e.folders&&e.folders.length&&$.each(e.folders,function(e,n){t.append(c(n))}),e.files&&e.files.length&&$.each(e.files,function(e,n){t.append(c(n))}),t.html()||(t=""),i.append(t),i}this.createMenu=function(){$("#menu").html(function(e){var i=$("<div></div>");e.folders&&e.folders.length&&$.each(e.folders,function(e,n){i.append(c(n))});e.files&&e.files.length&&$.each(e.files,function(e,n){i.append(c(n))});return i.html()}(e)),$(".menu__link").on("click",function(e){$("#menu .menu__focused").removeClass("menu__focused"),$(e.target).addClass("menu__focused")})}}function folder(e){this.id=e.id,this.type="folder",this.name=e.name||"Folder name",this.desc=e.desc||"Folder desc",this.image=e.image||"Folder image",this.folders=e.folders||[],this.files=e.files||[],this.parent_id=e.parent_id}function file(e){this.id=e.id,this.type="file",this.name=e.name||"File name",this.desc=e.desc||"File desc",this.image=e.image||"File image",this.content=e.content||"File content",this.parent_id=e.parent_id}$(".drawer__toggle_left").on("click",function(){$(".drawers").toggleClass("drawer__opened_left")}),$(".drawer__toggle_right").on("click",function(){$(".drawers").toggleClass("drawer__opened_right")});var arch={},localStorage_object_name="arch";function finder(r){var t;return function e(n){if(is_Object(n))for(var i in n.hasOwnProperty("id")&&n.id===r&&(t=n),n)n.hasOwnProperty(i)&&is_Array(n[i])&&n[i].length&&e(n[i]);if(is_Array(n))for(var i=0;i<n.length;i++)e(n[i])}(arch),t}function finderId(e){var r=[];return function e(n){if(is_Object(n))for(var i in n.hasOwnProperty("id")&&r.push(n.id),n)n.hasOwnProperty(i)&&is_Array(n[i])&&n[i].length&&e(n[i]);if(is_Array(n))for(var i=0;i<n.length;i++)e(n[i])}(e),r}function is_Object(e){return $.isPlainObject(e)}function is_Array(e){return $.isArray(e)}function is_Numeric(e){return $.isNumeric(e)}function get_local(){var e=localStorage.getItem(localStorage_object_name);e?arch=JSON.parse(e):(arch.folders=[],arch.files=[],arch.id_list=[])}function set_local(){localStorage.setItem(localStorage_object_name,JSON.stringify(arch))}function create_menu(){new Menu(arch).createMenu()}function focus_event(){$(".dm__add_folder").on("click",function(e){$("#menu .menu__link_folder").hasClass("menu__focused")?createFolder($("#menu .menu__link_folder.menu__focused").data("id")):createFolder()}),$(".dm__remove_folder").on("click",function(e){$("#menu .menu__link_folder").hasClass("menu__focused")&&delFolder($("#menu .menu__link_folder.menu__focused").data("id"))}),$(".dm__add_file").on("click",function(e){$("#menu .menu__link_folder").hasClass("menu__focused")?createFile($("#menu .menu__link_folder.menu__focused").data("id")):createFile()}),$(".dm__remove_file").on("click",function(e){$("#menu .menu__link_file").hasClass("menu__focused")&&delFile($("#menu .menu__link_file.menu__focused").data("id"))})}function createFile(e){var n=0<=e?finder(e):arch;if(n){var i={id:createId(),parent_id:0<=e?e:localStorage_object_name,content:cryptoIn()};n.files.push(new file(i)),arch=JSON.parse(JSON.stringify(arch)),set_local(),create_menu()}}function createFolder(e){var n=0<=e?finder(e):arch;if(n){var i={id:createId(),parent_id:0<=e?e:localStorage_object_name};n.folders.push(new folder(i)),arch=JSON.parse(JSON.stringify(arch)),set_local(),create_menu()}}function delFolder(e){if(0<=e){for(var n,i=finder(e),r=is_Numeric(i.parent_id)?finder(i.parent_id):arch,t=0;t<r.folders.length;t++)if(r.folders[t].id===i.id){n=t;break}r.folders.splice(n,1),removeId(i),set_local(),create_menu()}}function delFile(e){if(0<=e){for(var n,i=finder(e),r=is_Numeric(i.parent_id)?finder(i.parent_id):arch,t=0;t<r.files.length;t++)if(r.files[t].id===i.id){n=t;break}r.files.splice(n,1),removeId(i),set_local(),create_menu()}}function createId(){for(var e=arch.id_list.length,n=0;n<=e;n++)if(-1===arch.id_list.indexOf(n))return arch.id_list.push(n),n}function removeId(e){for(var n=arch.id_list,i=finderId(e),r=0;r<i.length;r++)n.splice(n.indexOf(i[r]),1)}function cryptoIn(){return utf8_to_b64($("#menu").html())}function cryptoOut(e){return b64_to_utf8(e)}function utf8_to_b64(e){return window.btoa(unescape(encodeURIComponent(e)))}function b64_to_utf8(e){return decodeURIComponent(escape(window.atob(e)))}$(document).ready(function(){get_local(),create_menu(),focus_event()});